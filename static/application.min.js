var haste_document=function(){this.locked=!1};haste_document.prototype.htmlEscape=function(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},haste_document.prototype.load=function(e,t,n){var r=this;$.ajax("/documents/"+e,{type:"get",dataType:"json",success:function(i){var s;r.locked=!0,r.key=e,r.data=i.data;try{n==="txt"?s={value:r.htmlEscape(i.data)}:n?s=hljs.highlight(n,i.data):s=hljs.highlightAuto(i.data)}catch(o){s=hljs.highlightAuto(i.data)}t({value:s.value,key:e,language:s.language||n,lineCount:i.data.split("\n").length})},error:function(){t(!1)}})},haste_document.prototype.save=function(e,t){if(this.locked)return!1;this.data=e;var n=this;$.ajax("/documents",{type:"post",data:e,dataType:"json",contentType:"application/json; charset=utf-8",success:function(r){n.locked=!0,n.key=r.key;var i=hljs.highlightAuto(e);t(null,{value:i.value,key:r.key,language:i.language,lineCount:e.split("\n").length})},error:function(e){try{t($.parseJSON(e.responseText))}catch(n){t({message:"Something went wrong!"})}}})};var haste_metadata=function(){this.data={comments:{},highlight:{}}};(function(){var e=function(e,t){return e-t},t=function(t){var n=[],r=[],i=-1,s=0;for(var o in t)t.hasOwnProperty(o)&&t[o]&&r.push(o);r.sort(e);for(var u=0;u<r.length;u+=1)s=r[u]*1,s!==i+1?n.push(s):n[n.length-1][1]?n[n.length-1][1]=s:n.push([n.pop(),s]),i=s;return n};haste_metadata.prototype.saveComment=function(e,t){e&&t&&(this.data.comments[e.toString()]=t)},haste_metadata.prototype.removeComment=function(e){e&&this.data.comments[e.toString()]&&delete this.data.comments[e.toString()]},haste_metadata.prototype.clearComments=function(){this.data.comments={}},haste_metadata.prototype.highlight=function(e){e&&(this.data.highlight[e.toString()]=!0)},haste_metadata.prototype.unhighlight=function(e){e&&this.data.highlight[e.toString()]&&delete this.data.highlight[e.toString()]},haste_metadata.prototype.clearHighlight=function(){this.data.highlight={}},haste_metadata.prototype.serialize=function(){var e={comments:this.data.comments,highlight:t(this.data.highlight)};return JSON.stringify(e)}})();var haste=function(e,t){this.appName=e,this.$textarea=$("textarea"),this.$box=$("#box"),this.$code=$("#box code"),this.$linenos=$("#linenos"),this.options=t,this.commenting=!1,this.configureShortcuts(),this.configureButtons(),t.twitter||$("#box2 .twitter").hide()};haste.prototype.setTitle=function(e){var t=e?this.appName+" - "+e:this.appName;document.title=t},haste.prototype.showMessage=function(e,t){var n=$('<li class="'+(t||"info")+'">'+e+"</li>");$("#messages").prepend(n),setTimeout(function(){n.slideUp("fast",function(){$(this).remove()})},3e3)},haste.prototype.lightKey=function(){this.configureKey(["new","save"])},haste.prototype.fullKey=function(){this.configureKey(["new","duplicate","comment","raw"])},haste.prototype.configureKey=function(e){var t,n=0;$("#box2 .function").each(function(){t=$(this);for(n=0;n<e.length;n++)if(t.hasClass(e[n]))return t.addClass("enabled"),!0;t.removeClass("enabled")})},haste.prototype.newDocument=function(e){this.$box.hide(),this.doc=new haste_document,e||window.history.pushState(null,this.appName,"/"),this.setTitle(),this.lightKey(),this.$textarea.val("").show("fast",function(){this.focus()}),this.removeLineNumbers()},haste.extensionMap={rb:"ruby",py:"python",pl:"perl",php:"php",scala:"scala",go:"go",xml:"xml",html:"xml",htm:"xml",css:"css",js:"javascript",vbs:"vbscript",lua:"lua",pas:"delphi",java:"java",cpp:"cpp",cc:"cpp",m:"objectivec",vala:"vala",cs:"cs",sql:"sql",sm:"smalltalk",lisp:"lisp",ini:"ini",diff:"diff",bash:"bash",sh:"bash",tex:"tex",erl:"erlang",hs:"haskell",md:"markdown",txt:"",coffee:"coffee",json:"javascript"},haste.prototype.lookupExtensionByType=function(e){for(var t in haste.extensionMap)if(haste.extensionMap[t]===e)return t;return e},haste.prototype.lookupTypeByExtension=function(e){return haste.extensionMap[e]||e},haste.prototype.addLineNumbers=function(e){var t="",n="";for(var r=0;r<e;r++)t+="<div>"+(r+1).toString()+"</div>\n",n+="<div></div>\n";$("#linenos").html(t),$("#line-highlights").html(n)},haste.prototype.removeLineNumbers=function(){$("#linenos").html("&gt;"),$("#line-highlights").html("")},haste.prototype.highlightLine=function(e){$("#line-highlights div").eq(e-1).addClass("h")},haste.prototype.unhighlightLine=function(e){$("#line-highlights div").eq(e-1).removeClass("h")},haste.prototype.toggleHighlightLine=function(e){$("#line-highlights div").eq(e-1).toggleClass("h")};var insertLine=function(e,t,n){var r=e.html().split("\n");r.splice(t-1,0,n),e.html(r.join("\n"))},removeLine=function(e,t){var n=e.html().split("\n");n.splice(t-1,1),e.html(n.join("\n"))};haste.prototype.insertBlankLine=function(e){insertLine($("code"),e,""),insertLine($("#linenos"),e,'<div class="blank">&nbsp;</div>'),insertLine($("#line-highlights"),e,"<div></div>");var t=$("#linenos .blank").offset();return t&&t.top||0},haste.prototype.removeLine=function(e){removeLine($("code"),e),removeLine($("#linenos"),e),removeLine($("#line-highlights"),e)},haste.prototype.showNewComment=function(e){var t=$("#comment-input input");e&&t.val(":"+e+" ").keyup(),$("#comment-input").fadeIn("fast",function(){t.focus()}),this.commenting=!0},haste.prototype.dismissNewComment=function(){this.commenting=!1,$("input#new-comment").val("").keyup(),$("#comment-input").hide()},haste.prototype.loadDocument=function(e){var t=e.split(".",2),n=this;n.doc=new haste_document,n.doc.load(t[0],function(e){e?(n.$code.html(e.value),n.setTitle(e.key),n.fullKey(),n.$textarea.val("").hide(),n.$box.show().focus(),n.addLineNumbers(e.lineCount)):n.newDocument()},this.lookupTypeByExtension(t[1]))},haste.prototype.duplicateDocument=function(){if(this.doc.locked){var e=this.doc.data;this.newDocument(),this.$textarea.val(e)}},haste.prototype.lockDocument=function(){var e=this;this.doc.save(this.$textarea.val(),function(t,n){if(t)e.showMessage(t.message,"error");else if(n){e.$code.html(n.value),e.setTitle(n.key);var r="/"+n.key;n.language&&(r+="."+e.lookupExtensionByType(n.language)),window.history.pushState(null,e.appName+"-"+n.key,r),e.fullKey(),e.$textarea.val("").hide(),e.$box.show().focus(),e.addLineNumbers(n.lineCount)}})},haste.prototype.configureButtons=function(){var e=this;this.buttons=[{$where:$("#box2 .save"),label:"Save",shortcutDescription:"control + s",shortcut:function(e){return e.ctrlKey&&e.keyCode===83},action:function(){e.$textarea.val().replace(/^\s+|\s+$/g,"")!==""&&e.lockDocument()}},{$where:$("#box2 .new"),label:"New",shortcut:function(e){return e.ctrlKey&&e.keyCode===78},shortcutDescription:"control + n",action:function(){e.newDocument(!e.doc.key)}},{$where:$("#box2 .duplicate"),label:"Duplicate & Edit",shortcut:function(t){return e.doc.locked&&t.ctrlKey&&t.keyCode===68},shortcutDescription:"control + d",action:function(){e.duplicateDocument()}},{$where:$("#box2 .raw"),label:"Just Text",shortcut:function(e){return e.ctrlKey&&e.shiftKey&&e.keyCode===82},shortcutDescription:"control + shift + r",action:function(){window.location.href="/raw/"+e.doc.key}},{$where:$("#box2 .twitter"),label:"Twitter",shortcut:function(t){return e.options.twitter&&e.doc.locked&&t.shiftKey&&t.ctrlKey&&t.keyCode==84},shortcutDescription:"control + shift + t",action:function(){window.open("https://twitter.com/share?url="+encodeURI(window.location.href))}},{$where:$("#box2 .comment"),label:"Comment",shortcut:function(t){return e.doc.locked&&t.shiftKey&&t.ctrlKey&&t.keyCode==77},shortcutDescription:"control + shift + m",action:function(){e.showNewComment()}},{$where:undefined,shortcut:function(t){return e.doc.locked&&t.keyCode==27},action:function(){e.dismissNewComment()}}];for(var t=0;t<this.buttons.length;t++)this.configureButton(this.buttons[t])},haste.prototype.configureButton=function(e){if(e.$where===undefined)return;e.$where.click(function(t){t.preventDefault(),!e.clickDisabled&&$(this).hasClass("enabled")&&e.action()}),e.$where.mouseenter(function(){$("#box3 .label").text(e.label),$("#box3 .shortcut").text(e.shortcutDescription||""),$("#box3").show(),$(this).append($("#pointer").remove().show())}),e.$where.mouseleave(function(){$("#box3").hide(),$("#pointer").hide()})},haste.prototype.configureShortcuts=function(){var e=this;$(document.body).keydown(function(t){var n;for(var r=0;r<e.buttons.length;r++){n=e.buttons[r];if(n.shortcut&&n.shortcut(t)){t.preventDefault(),n.action();return}}})},function(){var e=null,t=function(t){var n=t.target.location.pathname;n==="/"?e.newDocument(!0):e.loadDocument(n.substring(1,n.length))};setTimeout(function(){window.onpopstate=function(e){try{t(e)}catch(n){}}},1e3),$(function(){e=new haste("hastebin ce",{twitter:!1}),window.hasteapp=e,t({target:window})})}(),$(function(){var e=/^\s*:(\d+)\s+/,t=-1,n=$("#comment-input"),r=$("#comment-input span"),i=function(e){e?(n.css({top:e+"px"}),r.css({top:"16px"})):(n.css({top:0}),r.css({top:0}))};$("input#new-comment").keyup(function(){var n,r,s=this.value,o=e.exec(s);o?(n=o[1],t===-1?(t=n*1,r=window.hasteapp.insertBlankLine(t),i(r)):t!==n*1&&(window.hasteapp.removeLine(t),t=n*1,i(0))):t>=0&&(window.hasteapp.removeLine(t),t=-1,i(0))}),$("#linenos").on("click","div",function(e){var t=this.textContent;e.shiftKey?window.hasteapp.toggleHighlightLine(t):window.hasteapp.showNewComment(t)}),$("textarea").keydown(function(e){var t;if(e.keyCode===9){e.preventDefault();var n="  ";if(document.selection)this.focus(),t=document.selection.createRange(),t.text=n,this.focus();else if(this.selectionStart||this.selectionStart=="0"){var r=this.selectionStart,i=this.selectionEnd,s=this.scrollTop;this.value=this.value.substring(0,r)+n+this.value.substring(i,this.value.length),this.focus(),this.selectionStart=r+n.length,this.selectionEnd=r+n.length,this.scrollTop=s}else this.value+=n,this.focus()}})})